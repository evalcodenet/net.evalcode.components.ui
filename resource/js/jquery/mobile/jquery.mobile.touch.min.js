(function(g,t,l){"function"==typeof define&&define.amd?define(["jquery"],function(q){return l(q,g,t),q.mobile}):l(g.jQuery,g,t)})(this,document,function(g,t,l,q){(function(b,g,u,y){function k(b){for(;b&&"undefined"!=typeof b.originalEvent;)b=b.originalEvent;return b}function v(h){for(var a={},f,c;h;){f=b.data(h,n);for(c in f)f[c]&&(a[c]=a.hasVirtualBinding=!0);h=h.parentNode}return a}function l(){w&&(clearTimeout(w),w=0);w=setTimeout(function(){z=w=0;D.length=0;F=!1;A=!0},b.vmouse.resetTimerDuration)}
function p(h,a,f){var c,e;if(!(e=f&&f[h])){if(f=!f)a:{for(f=a.target;f;){if((e=b.data(f,n))&&(!h||e[h]))break a;f=f.parentNode}f=null}e=f}if(e){c=a;f=c.type;var d,m;c=b.Event(c);c.type=h;h=c.originalEvent;e=b.event.props;-1<f.search(/^(mouse|click)/)&&(e=t);if(h)for(m=e.length,d;m;)d=e[--m],c[d]=h[d];-1<f.search(/mouse(down|up)|click/)&&!c.which&&(c.which=1);if(-1!==f.search(/^touch/)&&(d=k(h),f=d.touches,d=d.changedTouches,h=f&&f.length?f[0]:d&&d.length?d[0]:y))for(f=0,e=I.length;f<e;f++)d=I[f],
c[d]=h[d];b(a.target).trigger(c)}return c}function J(a){var c=b.data(a.target,B),f;!(F||z&&z===c)&&(f=p("v"+a.type,a),f&&(f.isDefaultPrevented()&&a.preventDefault(),f.isPropagationStopped()&&a.stopPropagation(),f.isImmediatePropagationStopped()&&a.stopImmediatePropagation()))}function a(a){var c=k(a).touches,f;c&&1===c.length&&(f=a.target,c=v(f),c.hasVirtualBinding&&(z=M++,b.data(f,B,z),w&&(clearTimeout(w),w=0),x=A=!1,f=k(a).touches[0],q=f.pageX,K=f.pageY,p("vmouseover",a,c),p("vmousedown",a,c)))}
function c(b){A||(x||p("vmousecancel",b,v(b.target)),x=!0,l())}function d(a){if(!A){var c=k(a).touches[0],f=x,d=b.vmouse.moveDistanceThreshold,e=v(a.target);(x=x||Math.abs(c.pageX-q)>d||Math.abs(c.pageY-K)>d)&&!f&&p("vmousecancel",a,e);p("vmousemove",a,e);l()}}function e(b){if(!A){A=!0;var a=v(b.target),c,d;p("vmouseup",b,a);x||(c=p("vclick",b,a),c&&c.isDefaultPrevented()&&(d=k(b).changedTouches[0],D.push({touchID:z,x:d.clientX,y:d.clientY}),F=!0));p("vmouseout",b,a);x=!1;l()}}function m(a){a=b.data(a,
n);var c;if(a)for(c in a)if(a[c])return!0;return!1}function L(){}function N(h){var g=h.substr(1);return{setup:function(){m(this)||b.data(this,n,{});b.data(this,n)[h]=!0;r[h]=(r[h]||0)+1;1===r[h]&&E.bind(g,J);b(this).bind(g,L);G&&(r.touchstart=(r.touchstart||0)+1,1===r.touchstart&&E.bind("touchstart",a).bind("touchend",e).bind("touchmove",d).bind("scroll",c))},teardown:function(){--r[h];r[h]||E.unbind(g,J);G&&(--r.touchstart,r.touchstart||E.unbind("touchstart",a).unbind("touchmove",d).unbind("touchend",
e).unbind("scroll",c));var f=b(this),k=b.data(this,n);k&&(k[h]=!1);f.unbind(g,L);m(this)||f.removeData(n)}}}var n="virtualMouseBindings",B="virtualTouchID";g="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" ");var I="clientX clientY pageX pageY screenX screenY".split(" "),t=b.event.props.concat(b.event.mouseHooks?b.event.mouseHooks.props:[]),r={},w=0,q=0,K=0,x=!1,D=[],F=!1,A=!1,G="addEventListener"in u,E=b(u),M=1,z=0,H,C;b.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,
resetTimerDuration:1500};for(C=0;C<g.length;C++)b.event.special[g[C]]=N(g[C]);G&&u.addEventListener("click",function(a){var c=D.length,d=a.target,e,m,g,k,n;if(c)for(e=a.clientX,m=a.clientY,H=b.vmouse.clickDistanceThreshold,g=d;g;){for(k=0;k<c;k++)if(n=D[k],g===d&&Math.abs(n.x-e)<H&&Math.abs(n.y-m)<H||b.data(g,B)===n.touchID){a.preventDefault();a.stopPropagation();return}g=g.parentNode}},!0)})(g,t,l);g.mobile={};(function(b,g){var u={touch:"ontouchend"in l};b.mobile.support=b.mobile.support||{};b.extend(b.support,
u);b.extend(b.mobile.support,u)})(g);(function(b,g,u){function y(a,c,d,e){var m=d.type;d.type=c;e?b.event.trigger(d,u,a):b.event.dispatch.call(a,d);d.type=m}var k=b(l),v=b.mobile.support.touch,t=v?"touchstart":"mousedown",p=v?"touchend":"mouseup",q=v?"touchmove":"mousemove";b.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "),function(a,c){b.fn[c]=function(a){return a?this.bind(c,a):this.trigger(c)};b.attrFn&&(b.attrFn[c]=!0)});b.event.special.scrollstart=
{enabled:!0,setup:function(){function a(a,b){d=b;y(c,d?"scrollstart":"scrollstop",a)}var c=this,d,e;b(c).bind("touchmove scroll",function(c){b.event.special.scrollstart.enabled&&(d||a(c,!0),clearTimeout(e),e=setTimeout(function(){a(c,!1)},50))})},teardown:function(){b(this).unbind("touchmove scroll")}};b.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var a=this,c=b(a),d=!1;c.bind("vmousedown",function(e){function g(){clearTimeout(B)}function p(){g();c.unbind("vclick",
l).unbind("vmouseup",g);k.unbind("vmousecancel",p)}function l(b){p();d||n!==b.target?d&&b.preventDefault():y(a,"tap",b)}d=!1;if(e.which&&1!==e.which)return!1;var n=e.target,B;c.bind("vmouseup",g).bind("vclick",l);k.bind("vmousecancel",p);B=setTimeout(function(){b.event.special.tap.emitTapOnTaphold||(d=!0);y(a,"taphold",b.Event("taphold",{target:n}))},b.event.special.tap.tapholdThreshold)})},teardown:function(){b(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup");k.unbind("vmousecancel")}};
b.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1E3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(a){var b=g.pageXOffset,d=g.pageYOffset,e=a.clientX,m=a.clientY;if(0===a.pageY&&Math.floor(m)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(e)>Math.floor(a.pageX))e-=b,m-=d;else if(m<a.pageY-d||e<a.pageX-b)e=a.pageX-b,m=a.pageY-d;return{x:e,y:m}},start:function(a){var c=b.event.special.swipe.getLocation(a.originalEvent.touches?a.originalEvent.touches[0]:
a);return{time:(new Date).getTime(),coords:[c.x,c.y],origin:b(a.target)}},stop:function(a){a=b.event.special.swipe.getLocation(a.originalEvent.touches?a.originalEvent.touches[0]:a);return{time:(new Date).getTime(),coords:[a.x,a.y]}},handleSwipe:function(a,c,d,e){if(c.time-a.time<b.event.special.swipe.durationThreshold&&Math.abs(a.coords[0]-c.coords[0])>b.event.special.swipe.horizontalDistanceThreshold&&Math.abs(a.coords[1]-c.coords[1])<b.event.special.swipe.verticalDistanceThreshold){var g=a.coords[0]>
c.coords[0]?"swipeleft":"swiperight";return y(d,"swipe",b.Event("swipe",{target:e,swipestart:a,swipestop:c}),!0),y(d,g,b.Event(g,{target:e,swipestart:a,swipestop:c}),!0),!0}return!1},eventInProgress:!1,setup:function(){var a,c=this,d=b(c),e={};(a=b.data(this,"mobile-events"))||(a={length:0},b.data(this,"mobile-events",a));a.length++;a.swipe=e;e.start=function(a){if(!b.event.special.swipe.eventInProgress){b.event.special.swipe.eventInProgress=!0;var d,g=b.event.special.swipe.start(a),n=a.target,l=
!1;e.move=function(a){g&&!a.isDefaultPrevented()&&(d=b.event.special.swipe.stop(a),l||(l=b.event.special.swipe.handleSwipe(g,d,c,n),l&&(b.event.special.swipe.eventInProgress=!1)),Math.abs(g.coords[0]-d.coords[0])>b.event.special.swipe.scrollSupressionThreshold&&a.preventDefault())};e.stop=function(){l=!0;b.event.special.swipe.eventInProgress=!1;k.off(q,e.move);e.move=null};k.on(q,e.move).one(p,e.stop)}};d.on(t,e.start)},teardown:function(){var a,c;(a=b.data(this,"mobile-events"))&&(c=a.swipe,delete a.swipe,
a.length--,0===a.length&&b.removeData(this,"mobile-events"));c&&(c.start&&b(this).off(t,c.start),c.move&&k.off(q,c.move),c.stop&&k.off(p,c.stop))}};b.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(a,c){b.event.special[a]={setup:function(){b(this).bind(c,b.noop)},teardown:function(){b(this).unbind(c)}}})})(g,this)});
